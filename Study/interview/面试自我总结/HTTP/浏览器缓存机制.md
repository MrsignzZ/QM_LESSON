# 浏览器缓存
> 浏览器缓存分为强缓存和协商缓存。当客户端请求某个资源时，获取缓存的流程如下

- 先根据这个资源的一些 http header 判断它是否命中强缓存，如果命中，则直接从本地获取缓存资源，不会发请求到服务器；

- 当强缓存没有命中时，客户端会发送请求到服务器，服务器通过另一些request header验证这个资源是否命中协商缓存，称为http再验证，如果命中，服务器将请求返回，但不返回资源，而是告诉客户端直接从缓存中获取，客户端收到返回后就会从缓存中获取资源；

- 强缓存和协商缓存共同之处在于，如果命中缓存，服务器都不会返回资源； 区别是，强缓存不对发送请求到服务器，但协商缓存会。

- 当协商缓存也没命中时，服务器就会将资源发送回客户端。

- 当 ctrl+f5 强制刷新网页时，直接从服务器加载，跳过强缓存和协商缓存；

- 当 f5刷新网页时，跳过强缓存，但是会检查协商缓存；

|          |  获取资源形式  | 状态码 |  发送请求到服务器    |
|----------|:------------- |------:|---------------------|
|   强缓存 |   从缓存取	    |   200  |   否，直接从缓存取   |
| 协商缓存 |     从缓存取	  |   304  |是，正如其名，通过服务器来告知缓存是否可用|

## 强缓存
- expires: http1.0规范，返回一个绝对时间的字符串

- Cache-Control: http1.1规范，返回一个max-age（资源第一次的请求时间和Cache-Control设定的有效期）
  - no-cache: 不使用本地缓存，向服务器进行有效期确认处理
  - no-store: 禁止缓存

> Cache-Control 优先级高于expires
## 协商缓存
  - 协商缓存都是由服务器来确定缓存资源是否可用的，所以客户端与服务器端要通过某种标识来进行通信，涉及到以下两种方式

  1. Last-Modified/If-Modified-Since
      - 浏览器第一次跟服务器请求一个资源，服务器在返回这个资源的同时，在respone的header加上Last-Modified的header，这个header表示这个资源在服务器上的最后修改时间

      - 浏览器再次跟服务器请求这个资源时，在request的header上加上If-Modified-Since的header，这个header的值就是上一次请求时返回的Last-Modified的值

      - 服务器再次收到资源请求时，根据浏览器传过来If-Modified-Since和资源在服务器上的最后修改时间判断资源是否有变化，如果没有变化则返回304 Not Modified，但是不会返回资源内容；如果有变化，就正常返回资源内容。当服务器返回304 Not Modified的响应时，response header中不会再添加Last-Modified的header，因为既然资源没有变化，那么Last-Modified也就不会改变，这是服务器返回304时的response header

      - 浏览器收到304的响应后，就会从缓存中加载资源

      - 如果协商缓存没有命中，浏览器直接从服务器加载资源时，Last-Modified的Header在重新加载的时候会被更新，下次请求时，If-Modified-Since会启用上次返回的Last-Modified值

  2. Etag/If-None-Match
      - 这两个值是由服务器生成的每个资源的唯一标识字符串，只要资源有变化就这个值就会改变；其判断过程与Last-Modified/If-Modified-Since类似

  > Last-Modified与ETag是可以一起使用的，服务器会优先验证ETag，一致的情况下，才会继续比对Last-Modified，最后才决定是否返回304。